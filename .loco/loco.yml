format: 'loco-0.1'
default_environment:
 - HTTPD_DOMAIN=localhost
 - HTTPD_PORT=8000
 - HTTPD_ROOT=$LOCO_PRJ/web
 - LOCALHOST=127.0.0.1
 - MYSQL_PORT=3306
 - PHPFPM_PORT=9000
 - REDIS_PORT=6379
 - XDEBUG_PORT=9000
 - MAIL_SMTP_PORT=1025
 - MAIL_HTTP_PORT=1080

environment:
 - MYSQL_HOME=$LOCO_VAR/mysql/conf

services:

  redis:
    run: 'redis-server --port "$REDIS_PORT" --bind "$LOCALHOST" --pidfile "$LOCO_SVC_VAR/redis.pid" --dir "$LOCO_SVC_VAR"'
    pid_file: '$LOCO_SVC_VAR/redis.pid'

  php-fpm:
    run: 'php-fpm -y "$LOCO_SVC_VAR/php-fpm.conf" --nodaemonize'
    pid_file: '$LOCO_SVC_VAR/php-fpm.pid'

  apache:
    depends: [php-fpm]
    init:
      - cp "$LOCO_SVC_CFG"/conf/{magic,mime.types} "$LOCO_SVC_VAR/conf"
      - mk-apache-links
    run: 'apachectl -d "$LOCO_SVC_VAR" -DFOREGROUND'
    pid_file: '$LOCO_SVC_VAR/httpd.pid'

  mysql:
    init:
      - 'loco-mysql-init'
    run: 'mysqld --datadir="$LOCO_SVC_VAR/data"'
    pid_file: '$LOCO_SVC_VAR/run/mysql.pid'

  mailcatcher:
    run: 'mailcatcher --ip "$LOCALHOST" --smtp-port "$MAIL_SMTP_PORT" --http-port "$MAIL_HTTP_PORT" -f'
